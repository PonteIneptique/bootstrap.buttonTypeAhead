(function(e){e.fn.hasAttr=function(e){return this.attr(e)!==undefined};e.fn.btnTypeAhead=function(t){var n=e.extend({target:"data-target",aValue:"id",aText:"text",textParser:false,query:"query",method:"POST",StartOn:3,Save:false,saveUrl:"data-save",timeBetween:120,btnClass:"btn btn-infos",listStyle:"inline",btnStyle:"btn btn-primary",saveSentence:"Type enter to save your value",single:false},t);var r=this;var i=parseInt(e.now())-timeBetween;var s=0;r.each(function(){var t=e(this);var r=t.position();var o=parseInt(r.top);var u=parseInt(r.left);var a=parseInt(t.outerHeight());var f=o+a;t.attr("data-name",t.attr("name"));t.removeAttr("name");var l=t.attr("data-name");++s;t.attr("uid",s);t.addClass("btnTypeAhead-input-"+s);if(t.attr("data-id-equivalent")!==0){var c=t.attr("data-id-equivalent")}else{var c=n.aValue}if(t.attr("data-text-equivalent")!==0){var h=t.attr("data-text-equivalent")}else{var h=n.aText}if(t.attr("data-listStyle-equivalent")){var p=t.attr("data-listStyle-equivalent")}else{var p=n.listStyle}if(t.attr("data-btnStyle-equivalent")){var d=t.attr("data-btnStyle-equivalent")}else{var d=n.btnStyle;t.attr("data-btnStyle-equivalent",d)}if(t.attr("data-single-equivalent")){var v=t.attr("data-single-equivalent")}else{var v=n.single;t.attr("data-single-equivalent",v)}var m=e('<ul class="btnTypeAhead-ul btnTypeAhead-ul-'+s+' typeahead dropdown-menu" uid="'+s+'" style="display: none; min-width:'+t.outerWidth()+"px; top: "+f+"px; left:"+r.left+'px;"/>');if(t.parent().hasClass("input-prepend")){t.parent().after(m);var g=t.parent().next("ul")}else{t.after(m);var g=t.next("ul")}var y=e('<ul class="btnTypeAhead-selected btnTypeAhead-selected-'+s+" "+p+'" uid="'+s+'" style="margin-top:5px;" />');g.after(y);var b=g.next("ul");if(n.Save==true){t.keypress(function(r){if(r.which==13){r.preventDefault();query={};query[n.query]=t.val();if(e.now()-i>n.timeBetween){e.ajax({method:n.method,url:t.attr(n.saveUrl),data:query,dataType:"json"}).done(function(r){g.hide();if(typeof n.textParser=="function"){r[h]=n.textParser(r[h])}if(v===false){b.append('<li class="btnTypeAhead-li btnTypeAhead-li-'+s+'"><span class="'+d+'"><input type="hidden" class="'+l+'" name="'+l+'[]" value="'+r[c]+'" /> '+r[h]+' <i class="icon-remove"></i></span></li>');t.val("")}else{if(t.parent(".input-prepend").length==1){t.parent(".input-prepend").addClass("input-append");t.attr("disabled","disabled").val(r[h]).after('<span class="add-on btnTypeAhead-add-on"><i class="icon-remove"></i></span>');e(".btnTypeAhead-selected-"+s).append('<input type="hidden" class="'+l+'" name="'+l+'" value="'+r[c]+'" />')}else{}}})}}})}t.keyup(function(r){if(n.Save==true&&r.which==13){return false}else{query={};query[n.query]=t.val();if(t.val().length>=n.StartOn){e.ajax({method:n.method,url:t.attr(n.target),data:query,dataType:"json"}).done(function(r){g.find("li").remove();e.each(r,function(n,r){if(e("."+t.attr("data-name")+'[value="'+r[c]+'"]').length==0){g.append('<li><a href="#" class="btnTypeAhead-href btnTypeAhead-href-'+s+'" data-value="'+r[c]+'">'+r[h]+"</a></li>")}});if(g.find("li").length==0&&n.Save==true){g.append("<li>"+n.saveSentence+"</li>")}temppos=t.position();if(i!=parseInt(temppos.top)){var i=parseInt(temppos.top);var o=parseInt(temppos.top)+parseInt(t.outerHeight());g.css("top",o)}if(u!=parseInt(temppos.left)){var u=parseInt(temppos.left);var a=parseInt(temppos.left);g.css("left",a)}g.show()})}}});t.click(function(){if(g.find("li").length>0&&v===false){temppos=t.position();if(e!=parseInt(temppos.top)){var e=parseInt(temppos.top);var n=parseInt(temppos.top)+parseInt(t.outerHeight());g.css("top",n)}if(r!=parseInt(temppos.left)){var r=parseInt(temppos.left);var i=parseInt(temppos.left);g.css("left",i)}g.toggle()}})});e(document).on("click",".btnTypeAhead-href",function(t){t.preventDefault();href=e(this);ul=href.parents(".btnTypeAhead-ul");s=ul.attr("uid");input=e("input.btnTypeAhead-input-"+s);href.parent("li").remove();if(typeof n.textParser=="function"){text=n.textParser(href.text())}name=input.attr("data-name");if(input.attr("data-single-equivalent")==="false"){e(".btnTypeAhead-selected-"+s).append('<li class="btnTypeAhead-li btnTypeAhead-li-'+s+'"><span class="'+input.attr("data-btnStyle-equivalent")+'"><input type="hidden" class="'+name+'" name="'+name+'[]" value="'+href.attr("data-value")+'" /> '+text+' <i class="icon-remove"></i></span></li>')}else{if(input.parent(".input-prepend").length==1){input.parent(".input-prepend").addClass("input-append");input.attr("disabled","disabled").val(text).after('<span class="add-on btnTypeAhead-add-on"><i class="icon-remove"></i></span>');e(".btnTypeAhead-selected-"+s).append('<input type="hidden" class="'+name+'" name="'+name+'" value="'+href.attr("data-value")+'" />')}else{}}ul.hide();return false});e(document).on("click",".btnTypeAhead-li .icon-remove",function(){e(this).parents(".btnTypeAhead-li").remove();return true});e(document).on("click",".btnTypeAhead-add-on .icon-remove",function(){addon=e(this).parent();input=addon.prev("input");name=input.attr("data-name");input.attr("disabled",false);addon.remove();e('input[name="'+name+'"]').remove();return true});return r}})(jQuery);$("input.btnTypeAhead").btnTypeAhead()