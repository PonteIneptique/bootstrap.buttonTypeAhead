(function(e){e.fn.hasAttr=function(e){return this.attr(e)!==undefined};e.fn.btnTypeAhead=function(t){var n=e.extend({target:"data-target",aValue:"id",aText:"text",query:"queryz",method:"POST",StartOn:5,Save:true,saveUrl:"data-save",timeBetween:120,autoList:true,btnClass:"btn btn-infos",listStyle:"unstyled",btnStyle:"btn btn-primary",saveSentence:"Type enter to save your value"},t);var r=this;var i=0;var s=0;r.each(function(){var t=e(this);var r=t.position();var o=parseInt(r.top);var u=parseInt(r.left);var a=parseInt(t.outerHeight());var f=o+a;var l="a-"+t.attr("name");++s;t.attr("uid",s);t.addClass("btnTypeAhead-input-"+s);if(t.attr("data-id-equivalent")!==0){var c=t.attr("data-id-equivalent")}else{var c=n.aValue}if(t.attr("data-text-equivalent")!==0){var h=t.attr("data-text-equivalent")}else{var h=n.aText}if(t.hasAttr("data-listStyle-equivalent")){var p=t.attr("data-listStyle-equivalent")}else{var p=n.listStyle}if(t.hasAttr("data-btnStyle-equivalent")){var d=t.attr("data-btnStyle-equivalent")}else{var d=n.btnStyle;t.attr("data-btnStyle-equivalent",d)}var v=e('<ul class="btnTypeAhead-ul btnTypeAhead-ul-'+s+' typeahead dropdown-menu" uid="'+s+'" style="display: none; width:'+t.outerWidth()+"px; top: "+f+"px; left:"+r.left+'px;"/>');if(t.parent().hasClass("input-prepend")){t.parent().after(v);var m=t.parent().next("ul")}else{t.after(v);var m=t.next("ul")}var g=e('<ul class="btnTypeAhead-selected btnTypeAhead-selected-'+s+" "+p+'" uid="'+s+'" style="margin-top:5px;" />');m.after(g);var y=m.next("ul");if(n.Save==true){t.keypress(function(r){if(r.which==13){r.preventDefault();query={};query[n.query]=t.val();if(e.now()-i>n.timeBetween){e.ajax({method:n.method,url:t.attr(n.saveUrl),data:query,dataType:"json"}).done(function(e){m.hide();y.append('<li><span class="'+d+'"><input type="hidden" class="'+l+'" name="'+l+'[]" value="'+e[c]+'" /> '+e[h]+' <i class="icon-remove"></i></span></li>')})}}})}t.keyup(function(r){if(n.Save==true&&r.which==13){return false}else{query={};query[n.query]=t.val();if(t.val().length>=n.StartOn){e.ajax({method:n.method,url:t.attr(n.target),data:query,dataType:"json"}).done(function(r){m.find("li").remove();e.each(r,function(n,r){if(e(".a-"+t.attr("name")+'[value="'+r[c]+'"]').length==0){m.append('<li><a href="#" class="btnTypeAhead-href btnTypeAhead-href-'+s+'" data-value="'+r[c]+'">'+r[h]+"</a></li>")}});if(m.find("li").length==0&&n.Save==true){m.append("<li>"+n.saveSentence+"</li>")}temppos=t.position();if(i!=parseInt(temppos.top)){var i=parseInt(temppos.top);var o=parseInt(temppos.top)+parseInt(t.outerHeight());m.css("top",o)}if(u!=parseInt(temppos.left)){var u=parseInt(temppos.left);var a=parseInt(temppos.left);m.css("left",a)}m.show()})}}});t.click(function(){if(m.find("li").length>0){temppos=t.position();if(e!=parseInt(temppos.top)){var e=parseInt(temppos.top);var n=parseInt(temppos.top)+parseInt(t.outerHeight());m.css("top",n)}if(r!=parseInt(temppos.left)){var r=parseInt(temppos.left);var i=parseInt(temppos.left);m.css("left",i)}m.toggle()}})});e(document).on("click",".btnTypeAhead-href",function(t){t.preventDefault();href=e(this);ul=href.parents(".btnTypeAhead-ul");s=ul.attr("uid");input=e("input.btnTypeAhead-input-"+s);href.parent("li").remove();name="a-"+input.attr("name");ul.next(".btnTypeAhead-selected").append('<li class="btnTypeAhead-li btnTypeAhead-li-'+s+'"><span class="'+input.attr("data-btnStyle-equivalent")+'"><input type="hidden" class="'+name+'" name="'+name+'[]" value="'+href.attr("data-value")+'" /> '+href.text()+' <i class="icon-remove"></i></span></li>');ul.hide();return false});e(document).on("click",".btnTypeAhead-li .icon-remove",function(){e(this).parents(".btnTypeAhead-li").remove();return true});return r}})(jQuery);$("input.btnTypeAhead").btnTypeAhead()