(function(e){e.fn.btnTypeAhead=function(t){var n=e.extend({target:"data-target",aValue:"uid_platform",aText:"title_platform",query:"queryz",method:"POST",StartOn:5,Save:true,saveUrl:"data-save",timeBetween:120,autoList:true,saveSentence:"Type enter to save your value"},t);var r=this;var i=0;r.each(function(){var t=e(this);var r=t.position();s=parseInt(r.top);height=parseInt(t.outerHeight());var s=s+height;var o=e('<ul class="btnTypeAhead-ul typeahead dropdown-menu" style="display: none; width:'+t.outerWidth()+"px; top: "+s+"px; left:"+r.left+'px;"/>');t.after(o);var u=t.next("ul");var a=e('<ul class="btnTypeAhead-selected inline" style="margin-top:5px;" />');u.after(a);var f=u.next("ul");if(n.Save==true){t.keypress(function(r){if(r.which==13){r.preventDefault();query={};query[n.query]=t.val();if(e.now()-i>n.timeBetween){e.ajax({method:n.method,url:t.attr(n.saveUrl),data:query,dataType:"json"}).done(function(e){u.hide();f.append('<li><span class="btn btn-infos"><input type="hidden" class="'+name+'" name="'+name+'[]" value="'+e[n.aValue]+'" /> '+e[n.aText]+' <i class="icon-remove"></i></span></li>')})}}})}t.keyup(function(r){if(n.Save==true&&r.which==13){return false}else{query={};query[n.query]=t.val();if(t.val().length>=n.StartOn){e.ajax({method:n.method,url:t.attr(n.target),data:query,dataType:"json"}).done(function(r){u.find("li").remove();e.each(r,function(r,i){if(e(".a-"+t.attr("name")+'[value="'+i.uid_platform+'"]').length==0){t.next("ul").append('<li><a href="#" class="btnTypeAhead-href" data-value="'+i[n.aValue]+'">'+i[n.aText]+"</a></li>")}});if(u.find("li").length==0&&n.Save==true){t.next("ul").append("<li>"+n.saveSentence+"</li>")}u.show()})}}});t.click(function(){if(u.find("li").length>0){u.toggle()}})});e(document).on("click",".btnTypeAhead-href",function(t){t.preventDefault();href=e(this);ul=href.parents(".btnTypeAhead-ul");href.parent("li").remove();name="a-"+r.attr("name");ul.next(".btnTypeAhead-selected").append('<li><span class="btn btn-infos"><input type="hidden" class="'+name+'" name="'+name+'[]" value="'+href.attr("data-value")+'" /> '+href.text()+' <i class="icon-remove"></i></span></li>');ul.hide();return false});e(document).on("click",".btn > .icon-remove",function(){e(this).parent(".btn").remove();return true});return r}})(jQuery);$("input.btnTypeAhead").btnTypeAhead()