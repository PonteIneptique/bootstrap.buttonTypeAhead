(function(e){e.fn.hasAttr=function(e){return this.attr(e)!==undefined};e.fn.btnTypeAhead=function(t){var t=e.extend({target:"data-target",aValue:"id",aText:"text",textParser:false,query:"query",method:"POST",StartOn:3,Save:false,saveUrl:"data-save",timeBetween:120,btnClass:"btn btn-infos",listStyle:"inline",btnStyle:"btn btn-primary",saveSentence:"Type enter to save your value",single:false},t);var n=this;var r=0;n.each(function(){var n=e(this);var i=n.position();var s=parseInt(i.top);var o=parseInt(i.left);var u=parseInt(n.outerHeight());var a=s+u;n.attr("data-name",n.attr("name"));n.removeAttr("name");var f=n.attr("data-name");var l=f;n.data("BTA-Settings",t);n.data("BTA-Settings",e.extend({uid:f},n.data("BTA-Settings")));n.addClass("btnTypeAhead-input-"+f);if(n.attr("data-id-equivalent")){n.data("BTA-Settings",e.extend(n.data("BTA-Settings"),{aValue:n.attr("data-id-equivalent")}))}if(n.attr("data-text-equivalent")){n.data("BTA-Settings",e.extend(n.data("BTA-Settings"),{aText:n.attr("data-text-equivalent")}))}if(n.attr("data-listStyle-equivalent")){n.data("BTA-Settings",e.extend(n.data("BTA-Settings"),{listStyle:n.attr("data-listStyle-equivalent")}))}if(n.attr("data-btnStyle-equivalent")){n.data("BTA-Settings",e.extend(n.data("BTA-Settings"),{btnStyle:n.attr("data-btnStyle-equivalent")}))}if(n.attr("data-single-equivalent")){n.data("BTA-Settings",e.extend(n.data("BTA-Settings"),{single:true}))}var c=e('<ul class="btnTypeAhead-ul btnTypeAhead-ul-'+l+' typeahead dropdown-menu" uid="'+l+'" style="display: none; min-width:'+n.outerWidth()+"px; top: "+a+"px; left:"+i.left+'px;"/>');if(n.parent().hasClass("input-prepend")){n.parent().after(c);var h=n.parent().next("ul")}else{n.after(c);var h=n.next("ul")}var p=e('<ul class="btnTypeAhead-selected btnTypeAhead-selected-'+l+" "+n.data("BTA-Settings").listStyle+'" uid="'+l+'" style="margin-top:5px;" />');h.after(p);var d=h.next("ul");if(n.data("BTA-Settings").Save==true){n.keypress(function(t){var n=e(this);if(t.which==13){t.preventDefault();query={};query[n.data("BTA-Settings").query]=n.val();if(e.now()-r>n.data("BTA-Settings").timeBetween){e.ajax({method:n.data("BTA-Settings").method,url:n.attr(n.data("BTA-Settings").saveUrl),data:query,dataType:"json"}).done(function(t){h.hide();if(typeof n.data("BTA-Settings").textParser=="function"){t[n.data("BTA-Settings").aText]=n.data("BTA-Settings").textParser(t[n.data("BTA-Settings").aText])}if(n.data("BTA-Settings").single===false){d.append('<li class="btnTypeAhead-li btnTypeAhead-li-'+l+'"><span class="'+n.data("BTA-Settings").btnStyle+'"><input type="hidden" class="'+f+'" name="'+f+'[]" value="'+t[n.data("BTA-Settings").aValue]+'" /> '+t[n.data("BTA-Settings").aText]+' <i class="icon-remove"></i></span></li>');n.val("")}else{if(n.parent(".input-prepend").length==1){n.parent(".input-prepend").addClass("input-append");n.attr("disabled","disabled").val(t[n.data("BTA-Settings").aText]).after('<span class="add-on btnTypeAhead-add-on"><i class="icon-remove"></i></span>');e(".btnTypeAhead-selected-"+l).append('<input type="hidden" class="'+f+'" name="'+f+'" value="'+t[n.data("BTA-Settings").aValue]+'" />')}else{}}})}}})}n.keyup(function(t){var n=e(this);if(n.data("BTA-Settings").Save==true&&t.which==13){return false}else{query={};query[n.data("BTA-Settings").query]=n.val();if(n.val().length>=n.data("BTA-Settings").StartOn){e.ajax({method:n.data("BTA-Settings").method,url:n.attr(n.data("BTA-Settings").target),data:query,dataType:"json"}).done(function(t){h.find("li").remove();e.each(t,function(t,r){if(e("."+n.attr("data-name")+'[value="'+r[n.data("BTA-Settings").aValue]+'"]').length==0){var i=h.append('<li><a href="#" class="btnTypeAhead-href btnTypeAhead-href-'+l+'" data-value="'+r[n.data("BTA-Settings").aValue]+'">'+r[n.data("BTA-Settings").aText]+"</a></li>");i.data("BTA-Settings",{input:n})}});if(h.find("li").length==0&&n.data("BTA-Settings").Save==true){h.append("<li>"+n.data("BTA-Settings").saveSentence+"</li>")}temppos=n.position();if(r!=parseInt(temppos.top)){var r=parseInt(temppos.top);var i=parseInt(temppos.top)+parseInt(n.outerHeight());h.css("top",i)}if(s!=parseInt(temppos.left)){var s=parseInt(temppos.left);var o=parseInt(temppos.left);h.css("left",o)}h.show()})}}});n.click(function(){if(h.find("li").length>0&&n.data("BTA-Settings").single===false&&n.val().length>n.data("BTA-Settings").StartOn){var e=n.position();if(t!=parseInt(e.top)){var t=parseInt(e.top);var r=parseInt(e.top)+parseInt(n.outerHeight());h.css("top",r)}if(i!=parseInt(e.left)){var i=parseInt(e.left);var s=parseInt(e.left);h.css("left",s)}h.toggle()}});e(document).on("click",".btnTypeAhead-href-"+n.data("BTA-Settings").uid,function(t,n){t.preventDefault();var r=e(this);var i=r.parents(".btnTypeAhead-ul");var n=i.data("BTA-Settings").input;r.parent("li").remove();var s=r.text();if(typeof n.data("BTA-Settings").textParser=="function"){s=n.data("BTA-Settings").textParser(s)}var o=n.attr("data-name");if(n.data("BTA-Settings").single==false){e(".btnTypeAhead-selected-"+l).append('<li class="btnTypeAhead-li btnTypeAhead-li-'+n.data("BTA-Settings").uid+'"><span class="'+n.data("BTA-Settings").btnStyle+'"><input type="hidden" class="'+o+'" name="'+o+'[]" value="'+r.attr("data-value")+'" /> '+s+' <i class="icon-remove"></i></span></li>')}else{if(n.parent(".input-prepend").length==1){n.parent(".input-prepend").addClass("input-append");n.attr("disabled","disabled").val(s).after('<span class="add-on btnTypeAhead-add-on"><i class="icon-remove"></i></span>');e(".btnTypeAhead-selected-"+l).append('<input type="hidden" class="'+o+'" name="'+o+'" value="'+r.attr("data-value")+'" />')}else{}}i.hide();return false});e(document).on("click",".btnTypeAhead-li-"+n.data("BTA-Settings").uid+" .icon-remove",function(){e(this).parents(".btnTypeAhead-li").remove();return true})});e(document).on("click",".btnTypeAhead-add-on .icon-remove",function(){var t=e(this).parent();var n=t.prev("input");var r=n.attr("data-name");n.attr("disabled",false);t.remove();e('input[name="'+r+'"]').remove();return true});return n}})(jQuery)